// kagenou
function smsgTelegram(ctx){const m={};m.chat=ctx.chat?.id?.toString();m.chatType=ctx.chat?.type;m.isGroup=m.chatType!=='private';m.sender=ctx.from?.id?.toString();m.pushName=ctx.from?.first_name||ctx.from?.username||'Unknown';m.fromMe=false;m.id=ctx.update?.message?.message_id?.toString()||ctx.update?.callback_query?.id?.toString();let teks=ctx.callbackQuery?.data||ctx.message?.text?.trim()||ctx.message?.caption||'';let mediaInfo='';if(ctx.message?.document)mediaInfo=ctx.message.document.file_name||'[Document]';else if(ctx.message?.video)mediaInfo=ctx.message.video.file_name||'[Video]';else if(ctx.message?.audio)mediaInfo=ctx.message.audio.file_name||'[Audio]';else if(ctx.message?.voice)mediaInfo='[Voice Note]';else if(ctx.message?.sticker)mediaInfo=`[Sticker: ${ctx.message.sticker.emoji||'Sticker'}]`;else if(ctx.message?.photo)mediaInfo='[Photo]';else if(ctx.message?.contact)mediaInfo=`[Contact: ${ctx.message.contact.first_name}]`;else if(ctx.message?.location)mediaInfo=`[Location: ${ctx.message.location.latitude}, ${ctx.message.location.longitude}]`;else if(ctx.message?.poll)mediaInfo=`[Poll: ${ctx.message.poll.question}]`;else if(ctx.message?.dice)mediaInfo=`[Dice: ${ctx.message.dice.emoji} = ${ctx.message.dice.value}]`;else if(ctx.message?.game)mediaInfo=`[Game: ${ctx.message.game.title}]`;m.text=teks;m.body=teks||mediaInfo||'';m.caption=ctx.message?.caption||'';m.entities=ctx.message?.entities||[];m.callbackData=ctx.callbackQuery?.data;if(m.text.startsWith('/')){const[cmd,...args]=m.text.slice(1).split(' ');m.command=cmd.toLowerCase();m.args=args;}if(ctx.message?.reply_to_message){const q=ctx.message.reply_to_message;function detectMime(msg){if(msg.document)return msg.document.mime_type||msg.document.mimeType||null;if(msg.photo)return'image/jpeg';if(msg.video)return msg.video.mime_type||'video/mp4';if(msg.audio)return msg.audio.mime_type||'audio/mpeg';if(msg.voice)return'audio/ogg';if(msg.sticker)return msg.sticker.mime_type||'image/webp';return null;}
m.quoted={id:q.message_id?.toString(),text:q.text||q.caption||'',sender:q.from?.id?.toString(),chat:q.chat?.id?.toString(),fromMe:false,message:q,mime:detectMime(q),filename:q.document?.file_name||q.video?.file_name||q.audio?.file_name||null,download:async()=>{const tg=ctx.telegram;if(q.photo)return await tg.getFileLink(q.photo.at(-1).file_id);if(q.document)return await tg.getFileLink(q.document.file_id);if(q.video)return await tg.getFileLink(q.video.file_id);if(q.voice)return await tg.getFileLink(q.voice.file_id);if(q.audio)return await tg.getFileLink(q.audio.file_id);if(q.sticker)return await tg.getFileLink(q.sticker.file_id);return null;}};m.quoted.type=Object.keys(q).find(v=>['text','photo','video','audio','voice','document','sticker','contact','location','poll','dice','game'].includes(v))||'unknown';}
m.download=async()=>{const tg=ctx.telegram;if(ctx.message?.photo)return await tg.getFileLink(ctx.message.photo.at(-1).file_id);if(ctx.message?.document)return await tg.getFileLink(ctx.message.document.file_id);if(ctx.message?.video)return await tg.getFileLink(ctx.message.video.file_id);if(ctx.message?.voice)return await tg.getFileLink(ctx.message.voice.file_id);if(ctx.message?.audio)return await tg.getFileLink(ctx.message.audio.file_id);if(ctx.message?.sticker)return await tg.getFileLink(ctx.message.sticker.file_id);return null;};m.reply=(text,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.reply(text,opts);};m.replyWithPhoto=(photo,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.replyWithPhoto(photo,opts);};m.replyWithVideo=(video,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.replyWithVideo(video,opts);};m.replyWithAudio=(audio,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.replyWithAudio(audio,opts);};m.replyWithDocument=(doc,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.replyWithDocument(doc,opts);};m.replyWithSticker=(sticker,extra={})=>{const opts={reply_to_message_id:ctx.message?.message_id,...extra};return ctx.replyWithSticker(sticker,opts);};return m;}
module.exports=smsgTelegram;